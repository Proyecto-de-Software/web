FORMAT: 1A
HOST: https://admin-grupoXX.proyecto2025.linti.unlp.edu.ar/api

# Proyecto Sitios Históricos API
API para explorar sitios históricos, gestionar el perfil de usuario y crear/consultar reseñas.

::: note
## Nota
Recordá que estos endpoints son los mínimos que nos imaginamos desde la cátedra
como necesarios.

Si dentro del grupo o el docente asignado consideran que es necesario agregar
algún otro debido a las particularidades de la solución elegida deberán agregarlos.
:::

## Convenciones generales

**Autenticación**

Revisar los endpoints que requieren autenticación.

**Formato**

Todas las respuestas y solicitudes usan `application/json; charset=utf-8`.

**Paginación**

Parámetros `page` (≥1) y `per_page` (1..100) en los endpoints que lo soportan.

# Data Structures

# General Information

**Autenticación:**
Se requiere el header `Authorization: Bearer <token>` para crear/editar perfil y reseñas.

**Formato:**
Todas las respuestas y solicitudes usan `application/json; charset=utf-8`.

**Paginación:**
Parámetros `page` (≥1) y `per_page` (1..100) en los endpoints que lo soportan.

## SiteData
+ id: `1` (number) - Identificador único del sitio histórico.
+ name: `Fortín San Martín` (string, required) - Nombre del sitio histórico.
+ short_description: `Antiguo fortín militar...` (string, required) - Descripción corta del sitio histórico.
+ description: `Construcción del siglo XIX...` (string, required) - Descripción del sitio histórico.
+ city: `Córdoba` (string, required) - Ciudad donde se encuentra el sitio histórico.
+ province: `Córdoba` (string, required) - Provincia donde se encuentra el sitio histórico.
+ country: `AR` (string, required) - Código ISO del país donde se encuentra el sitio histórico.
+ lat: `-31.4201` (number, required) - Latitud.
+ long: `-64.1888` (number, required) - Longitud.
+ tags: `militar`, `siglo-xix` (array[string], required) - Etiquetas asociadas al sitio histórico.
+ state_of_conservation: `bueno` (enum[string], required) - Estado de conservación del sitio histórico.
    + Members
        + `excelente`
        + `bueno`
        + `regular`
        + `malo`
+ inserted_at: `2024-03-15T14:30:00Z` (string, required) - Fecha de creación del registro.
+ updated_at: `2024-06-20T09:15:00Z` (string, required) - Fecha de última actualización del registro.

## SiteListData
+ data (array[SiteData]) - Lista de sitios históricos.
+ meta (object) - Información de paginación.
    + page: `1` (number) - Número de página actual.
    + per_page: `20` (number) - Cantidad de elementos por página.
    + total: `57` (number) - Total de elementos en la lista.

## ReviewData
+ id: `1` (number, required) - Identificador único de la reseña.
+ site_id: `1` (number, required) - Identificador del sitio histórico asociado.
+ rating: `5` (enum[number], required) - Calificación otorgada.
    + Members
        + 1
        + 2
        + 3
        + 4
        + 5
+ comment: `Imperdible` (string, required) - Título de la reseña.
+ inserted_at: `2025-01-05T10:20:00Z` (string, required) - Fecha de creación de la reseña.
+ updated_at: `2025-06-12T08:00:00Z` (string, required) - Fecha de última actualización de la reseña.

## ReviewListData
+ data (array[ReviewData]) - Lista de reseñas.
+ meta (object) - Información de paginación.
    + page: `1` (number) - Número de página actual.
    + per_page: `10` (number) - Cantidad de elementos por página.
    + total: `35` (number) - Total de reseñas.

# Group Sitios Históricos

## Sitios Históricos [/sites{?name,description,city,province,tags,order_by,lat,long,radius,page,per_page}]

### Listar sitios [GET]

Obtiene una lista de sitios históricos que coinciden con los criterios de búsqueda.

**Información del endpoint**

<i class="fa fa-unlock"></i> No requiere autenticación.

+ Parameters
    + name: `fortín` (string, optional) - Filtra por nombre (búsqueda parcial, case-insensitive).
    + description: `siglo` (string, optional) - Filtra por descripción (búsqueda parcial, case-insensitive).
    + city: `Córdoba` (string, optional) - Filtra por ciudad (búsqueda exacta, case-insensitive).
    + province: `Córdoba` (string, optional) - Filtra por provincia (búsqueda exacta, case-insensitive).
    + tags: `militar,siglo-xix` (string, optional) - Filtra por etiquetas (múltiples separadas por comas).
    + order_by: `latest` (enum[string], optional) - Ordena los resultados.
        + Members
            + `rating-5-1`
            + `rating-1-5`
            + `latest`
            + `oldest`
    + lat: `-31.4201` (number, optional) - Latitud para búsqueda geoespacial.
    + long: `-64.1888` (number, optional) - Longitud para búsqueda geoespacial.
    + radius: `50` (number, optional) - Radio en kilómetros para la búsqueda geoespacial. Requiere `lat` y `long`.
    + page: `1` (number, optional) - Número de página (mínimo 1).
    + per_page: `20` (number, optional) - Cantidad de elementos por página (1 a 100).

+ Response 200 (application/json)
    + Attributes (SiteListData)

+ Response 400 (application/json)
  + Body
  
            {
               "error": {
                    "code": "invalid_query",
                    "message": "Parameter validation failed",
                    "details": {
                        "lat": ["Must be a valid latitude"],
                        "long": ["Must be a valid longitude"],
                        "per_page": ["Must be between 1 and 100"]
                    }
                }
            }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }


## Crear Sitio Históricos [/sites]

### Crear un sitio histórico [POST]

Crea un nuevo sitio histórico por un usuario de app pública.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Attributes (SiteData)
    + name: `Fortín de la Ciudadela` (string, required) - Nombre del sitio histórico.
    + short_description: `Antiguo fortín militar...` (string, required) - Descripción corta del sitio histórico.
    + description: `Un antiguo fortín del siglo XVIII` (string, required) - Descripción del sitio histórico.
    + city: `Córdoba` (string, required) - Ciudad donde se ubica el sitio histórico.
    + province: `Córdoba` (string, required) - Provincia donde se ubica el sitio histórico.
    + tags: `militar`, `siglo-xviii` (array[string], required) - Etiquetas asociadas al sitio histórico.
    + lat: `-31.4201` (number, required) - Latitud del sitio histórico.
    + long: `-64.1888` (number, required) - Longitud del sitio histórico.
    + state_of_conservation: `malo` (enum[string], required) - Estado de conservación del sitio histórico.
        + Members
            + `excelente`
            + `bueno`
            + `regular`
            + `malo`

+ Response 201 (application/json)
    + Attributes (SiteData)
        + id: `10` (number) - ID del sitio histórico.
        + short_description: `Antiguo fortín militar...` (string, required) - Descripción corta del sitio histórico.
        + description: `Un antiguo fortín del siglo XVIII` (string, required) - Descripción del sitio histórico.
        + city: `Córdoba` (string, required) - Ciudad donde se ubica el sitio histórico.
        + province: `Córdoba` (string, required) - Provincia donde se ubica
        + tags: `militar`, `siglo-xviii` (array[string], required) - Etiquetas asociadas al sitio histórico.
        + lat: `-31.4201` (number, required) - Latitud del sitio histórico.
        + long: `-64.1888` (number, required) - Longitud del sitio histórico.
        + state_of_conservation: `malo` (enum[string], required) - Estado de conservación del sitio histórico.
            + Members
                + `excelente`
                + `bueno`
                + `regular`
                + `malo`
        + user_id: `5` (number) - ID del usuario que creó el sitio histórico.

+ Response 400 (application/json)
    + Body
    
            { "error": { "code": "invalid_data", "message": "Invalid input data", "details": { "name": ["This field is required"] } } }

+ Response 401 (application/json)
    + Body

            { "error": { "code": "unauthorized", "message": "Unauthorized" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

## Sitio Histórico [/sites/{site_id}]

### Obtener un sitio histórico [GET]

Obtiene detalles de un sitio histórico específico por su ID.

**Información del endpoint**

<i class="fa fa-unlock"></i> No requiere autenticación.

+ Parameters
    + site_id: `10` (number) - ID del sitio histórico.

+ Response 200 (application/json)
    + Attributes (SiteData)

+ Response 404 (application/json)
    + Body
    
            { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

# Group Autenticación

## Login [/api/auth]

Se requiere de un token de acceso para acceder a los endpoints de información
de socio.

### Obtener token [POST]

Permite obtener el un JSON Web Token válido para el usuario y password.

+ Request (application/json)
    + Attributes
        + user: `john.doe@mail.com` (string, required) - User email address.
        + password: `QXR0mi38a2` (string, required) - User password.

+ Response 200 (application/json)
    + Attributes
        + token: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9....` (string) - JSON Web Token.
        + expires_in: `3600` (number) - Token expiration time in seconds.

+ Response 401 (application/json)
    + Body

            { "error": {"code": "invalid_credentials", "message": "Credenciales inválidas."} }

# Group Reseñas

## Reseñas de un sitio [/sites/{site_id}/reviews{?page,per_page}]

### Listar reseñas [GET]

Obtiene una lista paginada de reseñas para un sitio histórico específico.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
        
+ Parameters
    + site_id: `10` (number) - ID del sitio histórico.
    + page: `1` (number, optional) - Número de página (mínimo 1).
    + per_page: `10` (number, optional) - Cantidad de elementos por página (1 a 100).

+ Response 200 (application/json)
    + Attributes
        + data (array[ReviewData]) - Lista de reseñas.
            + (ReviewData)
                + id: 2 (number) - Identificador único de la reseña.
                + site_id: 101 (number) - ID del sitio histórico.
                + rating: 5 (number) - Calificación otorgada.
                + comment: Excelente (string) - Comentario adicional.
            + (ReviewData)
                + id: 3 (number) - Identificador único de la reseña.
                + site_id: 101 (number) - ID del sitio histórico.
                + rating: 4 (number) - Calificación otorgada.
                + comment: Muy bueno, pero falta señalización (string) - Comentario adicional.
        + meta (object) - Información de paginación.
            + page: 1 (number) - Número de página actual.
            + per_page: 10 (number) - Cantidad de elementos por página.
            + total: 35 (number) - Total de reseñas.

+ Response 400 (application/json)
    + Body

            { "error": { "code": "invalid_data", "message": "Invalid input data", "details": { "per_page": ["Must be between 1 and 100"] } } } }

+ Response 401 (application/json)
   + Body

            { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 404 (application/json)
    + Body
    
            { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

### Crear reseña [POST]

Crea una nueva reseña para un sitio histórico específico.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Parameters
    + site_id: `101` (number) - ID del sitio histórico.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

    + Attributes
        + rating: `4` (number, required) - Calificación otorgada (1 a 5).
        + site_id: `101` (number, required) - ID del sitio histórico.
        + comment: `Faltan carteles explicativos en el interior.` (string, optional) - Comentario adicional.

+ Response 201 (application/json)
    + Attributes (ReviewData)
       + id: `5` (number, required) - Identificador único de la reseña.
       + site_id: `101` (number, required) - ID del sitio histórico.
       + rating: `4` (number, required) - Calificación otorgada.
       + comment: `Faltan carteles explicativos en el interior.` (string, optional) - Comentario adicional.

+ Response 400 (application/json)
    + Body

            { "error": { "code": "invalid_data", "message": "Invalid input data", "details": { "rating": ["Must be between 1 and 5"] } } }

+ Response 401 (application/json)
   + Body

            { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 404 (application/json)
   + Body

            { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

## Reseña [/sites/{site_id}/reviews/{review_id}]

### Obtener reseña [GET]

Obtiene una reseña existente por su ID.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Parameters
    + site_id: `10` (number) - ID del sitio histórico.
    + review_id: `5` (number) - ID de la reseña a obtener.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Response 200 (application/json)
    + Attributes (ReviewData)

+ Response 400 (application/json)
    + Body

            { "error": { "code": "invalid_data", "message": "Invalid input data", "details": { "review_id": ["Must be a positive integer"] } } }

+ Response 401 (application/json)
    + Body

            { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 403 (application/json)
    + Body

            { "error": { "code": "forbidden", "message": "You do not have permission to access this review" } }

+ Response 404 (application/json)
    + Body
    
            { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

### Eliminar reseña propia [DELETE]

Elimina una reseña existente por su ID.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Parameters
    + site_id: `10` (number) - ID del sitio histórico.
    + review_id: `5` (number) - ID de la reseña a eliminar.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Response 204 (no content)

+ Response 401 (application/json)
    + Body

            { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 403 (application/json)
    + Body

            { "error": { "code": "forbidden", "message": "You do not have permission to delete this review" } }

+ Response 404 (application/json)
    + Body
    
            { "error": { "code": "not_found", "message": "Review not found" } }

+ Response 500 (application/json)
    + Body

            { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

# Group Favoritos

## Favorito de un sitio [/sites/{site_id}/favorite]

Representa la relación “el usuario autenticado marcó este sitio como favorito”.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación (JWT en `Authorization: Bearer <token>`).

+ Parameters
    + site_id: `10` (number) - ID del sitio histórico.

### Marcar como favorito [PUT]

Crea (o asegura) que el sitio esté marcado como favorito por el usuario autenticado.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Response 204

+ Response 401 (application/json)

        { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 404 (application/json)

        { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)

        { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

### Desmarcar como favorito [DELETE]

Elimina (o asegura que no exista) la relación de favorito.

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Response 204

+ Response 401 (application/json)

        { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 404 (application/json)

        { "error": { "code": "not_found", "message": "Site not found" } }

+ Response 500 (application/json)

        { "error": { "code": "server_error", "message": "An unexpected error occurred" } }

# Group Propio Usuario

## Favoritos del usuario [/me/favorites{?page,per_page}]

Lista paginada de sitios marcados como favoritos por el usuario autenticado.

**Información del endpoint**

<i class="fa fa-lock"></i> Requiere autenticación.

+ Parameters
    + page: `1` (number, optional) - Mínimo 1.
    + per_page: `20` (number, optional) - 1..100.

### Listar favoritos [GET]

+ Request (application/json)
    + Headers

            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

+ Response 200 (application/json)
    + Attributes
        + data (array[SiteData]) - Sitios favoritos (sugerencia: incluir `inserted_at` de la relación).
        + meta (object)
            + page: 1 (number)
            + per_page: 20 (number)
            + total: 5 (number)

+ Response 401 (application/json)

        { "error": { "code": "unauthorized", "message": "Authentication required" } }

+ Response 500 (application/json)

        { "error": { "code": "server_error", "message": "An unexpected error occurred" } }